(()=>{"use strict";var e={2029:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,l)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(r){t[r]=e[r]&&function(t){return new Promise((function(o,i){!function(e,t,r,o){Promise.resolve(o).then((function(t){e({value:t,done:r})}),t)}(o,i,(t=e[r](t)).done,t.value)}))}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NodeKinds=t.DtsWriter=t.Dts=void 0;const n=r(4007),l=r(6828),a=s(r(2361)),d=r(4470),c=r(3244);class u extends a.default{generate({name:e,main:t,inputDir:r,projectPath:i,outputPath:s,files:l=[],references:a=[]}){var u;return o(this,void 0,void 0,(function*(){let o={};const p=(0,c.resolver)(r),m=s?(0,c.resolver)(s).dir():p;if(s=s||p.resolve("index.d.ts"),this.emit("log",`[dts] generate for ${r} > ${s}`),!l.length||i){const e=yield this.getTsConfig(r,i);l=e.fileNames,o=e.compilerOptions}o.declaration=!0,o.target=o.target||n.ScriptTarget.Latest,o.outDir=o.outDir||m.rootPath;const f=(0,c.resolver)(o.rootDir||i||p.rootPath),g=o.outDir||m.rootPath,v=l,x=[`baseDir = "${f.rootPath}"`,`target = ${o.target.toString()}`,`outDir = ${g||""}`,`rootDir = ${o.rootDir||""}`,`moduleResolution = ${(null===(u=o.moduleResolution)||void 0===u?void 0:u.toString())||""}`,"files =",...v.map((e=>`  ${e}`))];this.emit("log:verbose","[dts] params:\n"+x.map((e=>`  ${e}`)).join("\n")),yield(0,d.mkdirp)((0,c.getDir)(s));const w=new h({name:e,main:t,references:a});w.on("log",(e=>this.emit("log",e))),w.on("log:verbose",(e=>this.emit("log:verbose",e))),yield w.write(f.rootPath,s,o,v)}))}getTsConfig(e,t){var r,s,n,l;return o(this,void 0,void 0,(function*(){const o=(0,c.resolver)(e),a=[t&&(0,c.resolver)(t).resolve("tsconfig.json"),t,o.resolve("tsconfig.json")].filter(Boolean);try{for(var u,h=!0,p=i(a);u=yield p.next(),!(r=u.done);){l=u.value,h=!1;try{const e=l;if(yield(0,d.pathExists)(e))return this.emit("log",`[dts] tsconfig from ${e}`),yield m(e)}finally{h=!0}}}catch(e){s={error:e}}finally{try{h||r||!(n=p.return)||(yield n.call(p))}finally{if(s)throw s.error}}throw Error(`Can't find tsconfig in ${t||o.rootPath}`)}))}}t.Dts=u;class h extends a.default{constructor(e){super(),this.ident="  ",this.externalModules=[],this.options=Object.assign({main:"index",references:[],excludedPatterns:["**/node_modules/**/*.d.ts","**/.yarn/**/*.d.ts"]},e),this.options.main||(this.options.main="index")}write(e,t,r,i){var s;return o(this,void 0,void 0,(function*(){this.externalModules=[],this.emit("log","[dtsw] start");const o=(0,n.createCompilerHost)(r),a=(0,n.createProgram)(i,r,o),u=a.getSourceFiles(),h=(0,c.resolver)(t).dir(),p=(0,c.resolver)(e),m=`${this.options.name}/${(null===(s=this.options.main)||void 0===s?void 0:s.replace(/^\/+/,""))||"index"}`;let v=[];this.listExternals(u),this.outDir=h,this.output=(0,d.createWriteStream)(t,{mode:parseInt("644",8)}),this.emit("log","[dtsw] process files"),this.writeReferences(),u.some((e=>{var t;const o=(0,c.normalize)(e.fileName);if(!p.includes(o))return this.emit("log:verbose",`[dtsw] process: ignored library ${o}`),!1;if(null===(t=this.options.excludedPatterns)||void 0===t?void 0:t.some((e=>(0,l.minimatch)(o,e))))return this.emit("log:verbose",`[dtsw] process: excluded ${o}`),!1;if(".d.ts"===o.slice(-5))return this.emit("log:verbose",`[dtsw] process: d.ts ${o}`),this.writeDeclaration(e),!1;const i=this.resolveModule({currentModule:p.relative(g(e.fileName))});m===i&&(this.emit("log:verbose",`[dtsw] main found ${m}`),v=this.getModuleExports(e));const s=a.emit(e,((e,t)=>{".d.ts"===e.slice(-5)?(this.emit("log:verbose",`[dtsw] process: ts ${e}`),this.writeDeclaration((0,n.createSourceFile)(e,t,r.target,!0))):this.emit("log:verbose",`[dtsw] process: ignored d.ts ${e}`)}));if(s.emitSkipped||s.diagnostics.length>0)throw this.emit("log:verbose",`[dtsw] process: ts ${o} error`),f(s.diagnostics.concat(a.getSemanticDiagnostics(e)).concat(a.getSyntacticDiagnostics(e)).concat(a.getDeclarationDiagnostics(e)));return!1})),this.writeMainDeclaration(r.target,v),this.output.close(),this.emit("log","[dtsw] done")}))}listExternals(e){this.emit("log","[dtsw] list externals"),e.forEach((e=>{p(e,(e=>{if(t.NodeKinds.isModuleDeclaration(e)){const r=e.name;t.NodeKinds.isStringLiteral(r)&&this.externalModules.push(r.text)}}))})),this.externalModules.length?this.emit("log:verbose",["[dtsw] list externals:",...this.externalModules.map((e=>`  - ${e}`))].join("\n")):this.emit("log:verbose","[dtsw] list externals: no externals found")}writeReferences(){var e;const t=/^\./;null===(e=this.options.references)||void 0===e||e.forEach((e=>{t.test(e)?(this.emit("log",`[dtsw] ref.path ${e}`),this.writeOutput(`/// <reference path="${e}" />`)):(this.emit("log",`[dtsw] ref.types ${e}`),this.writeOutput(`/// <reference types="${e}" />`))}))}writeDeclaration(e){var t;if(!this.outDir)throw Error("[dtsw] output dir not provided");const r=(0,c.resolve)(e.fileName),o=g(this.outDir.relative(r));e.externalModuleIndicator?this.writeExternalDeclaration(e,o):r!==(null===(t=this.output)||void 0===t?void 0:t.path)?(this.emit("log",`[dtsw] declare ${o} from text`),this.writeOutput(e.text),this.emit("log:verbose",`[dtsw] declare ${o} done`)):this.emit("log:verbose",`[dtsw] declare ignored ${o}`)}writeMainDeclaration(e,t=[]){if(!t.length)return;const r=`${this.options.name}/${this.options.main}`,o=[];this.emit("log",`[dtsw] declare:main ${r}`),!e||e<n.ScriptTarget.ES2015?(this.emit("log:verbose","[dtsw] declare:main require"),o.push(`import main = require('${r}');`),o.push("export = main;")):(t.includes("default")&&(this.emit("log:verbose","[dtsw] declare:main export default"),o.push(`export { default } from '${r}';`)),t.some((e=>"default"!==e))&&(this.emit("log:verbose","[dtsw] declare:main export *"),o.push(`export * from '${r}';`))),o.length||this.emit("log","[dtsw] declare:main no valid exports"),this.writeOutputModule(this.options.name,o)}getModuleExports(e){const r=[];return(0,n.forEachChild)(e,(e=>{var o;t.NodeKinds.isExportAssignment(e)?r.push("default"):t.NodeKinds.isExportDeclaration(e)?r.push("*"):t.NodeKinds.isNamedExports(e)?e.elements.forEach((e=>{var t;r.push((null===(t=e.propertyName)||void 0===t?void 0:t.getText())||e.name.getText())})):t.NodeKinds.isVariableStatement(e)&&(null===(o=e.modifiers)||void 0===o?void 0:o.some((e=>e.kind===n.SyntaxKind.ExportKeyword)))&&e.declarationList.declarations.length&&r.push(e.declarationList.declarations[0].name.getText())})),r}writeExternalDeclaration(e,r){const o=this.resolveModule({currentModule:r});this.emit("log",`[dtsw] declare:external ${o} (${e.fileName})`);const i=p(e,(e=>{if(t.NodeKinds.isExternalModuleReference(e)){const t=e.expression,i=this.resolveImport({importedModule:t.text,currentModule:r});return this.emit("log:verbose",`[dtsw] declare:external ${o}: require ${i}`),` require('${i}')`}if(t.NodeKinds.isDeclareKeyWord(e))return this.emit("log:verbose",`[dtsw] declare:external ${o}: ignored declare keyword`),"";if(t.NodeKinds.isStringLiteral(e)&&e.parent&&(t.NodeKinds.isExportDeclaration(e.parent)||t.NodeKinds.isImportDeclaration(e.parent))){const t=e.text,i=this.resolveImport({importedModule:t,currentModule:r});if(i)return this.emit("log:verbose",`[dtsw] declare:external ${o}: import ${i}`),` '${i}'`}})).join("").split(/[\r\n]+/).filter((e=>e&&"export {};"!==e));this.writeOutputModule(o,i),this.emit("log:verbose",`[dtsw] declare:external ${o} done`)}writeOutput(e,t=0){if(!this.output)throw Error("[dtsw] output stream not set");this.output.write(e+"\n")}writeOutputModule(e,t=[]){t.length&&(this.writeOutput(`declare module '${e}' {`),this.writeOutput(t.map((e=>`${this.ident}${e}`.replace(/\s{4}/g,this.ident))).join("\n")),this.writeOutput("}"))}resolveModule(e){let t=e.currentModule;return t=this.options.resolvedModule?this.options.resolvedModule(e)||t:t.replace(/^.+\/src/,"src"),t=`${this.options.name}/${t}`,this.emit("log:verbose",`[dtsw] resolve ${t} (${e.currentModule})`),t}resolveImport(e){const t=this.externalModules.includes(e.importedModule)||!/^\./.test(e.importedModule),r=t?e.importedModule:(0,c.merge)((0,c.getDir)(e.currentModule),e.importedModule);let o=r;return o=this.options.resolvedImport?this.options.resolvedImport({currentModule:e.currentModule,importedModule:r,isExternal:t})||o:o.replace(/^.+\/src/,"src"),o=t?o:`${this.options.name}/${o}`,this.emit("log:verbose",`[dtsw] resolve:import ${o}${t?" (external)":""} (${e.currentModule}, ${e.importedModule})`),o}}t.DtsWriter=h,t.NodeKinds={isDeclareKeyWord:e=>e&&e.kind===n.SyntaxKind.DeclareKeyword,isImportDeclaration:e=>e&&e.kind===n.SyntaxKind.ImportDeclaration,isExternalModuleReference:e=>e&&e.kind===n.SyntaxKind.ExternalModuleReference,isStringLiteral:e=>e&&e.kind===n.SyntaxKind.StringLiteral,isExportDeclaration:e=>e&&e.kind===n.SyntaxKind.ExportDeclaration,isExportAssignment:e=>e&&e.kind===n.SyntaxKind.ExportAssignment,isNamedExports:e=>e&&e.kind===n.SyntaxKind.NamedExports,isVariableStatement:e=>e&&e.kind===n.SyntaxKind.VariableStatement,isModuleDeclaration:e=>e&&e.kind===n.SyntaxKind.ModuleDeclaration};const p=(e,t)=>{const r=[];let o=0;return function i(s){!function(t){r.push(e.text.slice(o,t.pos)),o=t.pos}(s);const l=t(s);void 0!==l?(r.push(l),function(e){o=e.end}(s)):(0,n.forEachChild)(s,i)}(e),r.push(e.text.slice(o)),r.filter(Boolean)},m=e=>o(void 0,void 0,void 0,(function*(){var t;const r=yield(0,d.readFile)(e,{encoding:"utf8"}),o=(0,n.parseConfigFileTextToJson)(e,r);if(o.error)throw f([o.error]);const i=o.config,s=(0,n.parseJsonConfigFileContent)(i,n.sys,(0,c.getDir)(e));if(null===(t=s.errors)||void 0===t?void 0:t.length)throw f(s.errors);return{fileNames:s.fileNames,compilerOptions:s.options}})),f=e=>{const t=["Declaration generation failed"];e.forEach((e=>{const r="string"==typeof e.messageText?e.messageText:e.messageText.messageText;if(e.file){const o=e.file.getLineAndCharacterOfPosition(e.start||0);t.push(`${e.file.fileName}(${o.line+1},${o.character+1}): error TS${e.code}: ${r}`)}else t.push(`error TS${e.code}: ${r}`)}));const r=new Error(t.join("\n"));return r.name="EmitterError",r},g=e=>e.replace(/(\.d)?\.ts$/,"")},2944:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logEntries=t.logSuccess=t.logError=t.logWarn=t.logProgress=t.logInfo=t.log=void 0;const i=o(r(5022)),{bold:s,red:n,gray:l}=i.default;t.log=console.log.bind(console),t.logInfo=(...e)=>{console.info(s.blueBright("ℹ"),...e)},t.logProgress=(...e)=>{console.info(l("➤"),...e)},t.logWarn=(...e)=>{console.info(n("△"),...e)},t.logError=(...e)=>{e.forEach((e=>{console.error(s.underline.redBright("✘"),e)}))},t.logSuccess=(...e)=>{console.info(s.greenBright("✔"),...e)},t.logEntries=e=>{(0,t.logInfo)(s.cyanBright("Building entries:")),e.forEach((({name:e,target:r,entry:o})=>{(0,t.log)(`   ${e} (${i.default.italic(r)}):`),Object.keys(o).forEach((e=>{(0,t.log)(`     ${e}`)}))}))}},3244:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeExt=t.merge=t.resolve=t.resolver=t.getName=t.getDir=t.normalize=t.PathResolver=t.resolvePath=void 0;const o=r(1017);var i=r(1017);Object.defineProperty(t,"resolvePath",{enumerable:!0,get:function(){return i.resolve}});class s{constructor(e){this.rootPath=(0,t.normalize)((0,o.resolve)(e))}relative(e){return(0,t.normalize)((0,o.relative)(this.rootPath,(0,t.normalize)(e)))}relativeList(e){return e.map((e=>this.relative(e)))}includes(e){return 0===(0,t.normalize)(e).indexOf(this.rootPath)}resolve(...e){return(0,t.normalize)((0,o.resolve)(this.rootPath,...e.filter(Boolean).map((e=>e.replace(/^\/+/,"")))))}resolveList(e){return e.map((e=>this.resolve(e)))}dir(){return(0,t.resolver)((0,t.getDir)(this.rootPath))}res(...e){return(0,t.resolver)(this.resolve(...e))}}t.PathResolver=s,t.normalize=e=>(null==e?void 0:e.replace(/\\/g,"/"))||"",t.getDir=e=>(0,t.normalize)(e).replace(/\/[^/]+\/?$/,""),t.getName=e=>(0,o.basename)((0,t.normalize)(e)),t.resolver=e=>new s(e),t.resolve=e=>(0,t.normalize)((0,o.resolve)(e)),t.merge=(...e)=>(0,t.normalize)((0,o.join)(...e)),t.removeExt=e=>null==e?void 0:e.replace(/\.([^/]+)$/,"")},8780:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,l)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=r(4470),s=r(2029),n=r(2944),l=r(3244),a=/([^/]+\/[^/]+)/;t.default=class{constructor(e){this.rootPath=e,this.path=(0,l.resolver)(e)}apply(e){let t=[];e.hooks.beforeCompile.tapPromise("[dts] start collecting built modules",(()=>o(this,void 0,void 0,(function*(){t=[]})))),e.hooks.compilation.tap("[dts] setup compilation",(e=>{e.hooks.succeedModule.tap("[dts] collect built module",(e=>{if("NormalModule"!==e.constructor.name)return;const r=this.path.relative(e.context||""),o=!r.includes("node_modules")&&!r.includes(".yarn")&&r.match(a);o&&!t.includes(o[0])&&t.push(o[0])}))})),e.hooks.afterCompile.tapPromise("[dts] generate definitions",(()=>o(this,void 0,void 0,(function*(){yield Promise.all(t.map((e=>o(this,void 0,void 0,(function*(){try{const t=yield(0,i.readJSON)(this.path.resolve(e,"package.json")),r=t.types,o=t.name,a=this.path.resolve(e),d=this.path.resolve(e,r),c=this.path.resolve(e,"tsconfig.json"),u=t.main||"index";if(!r)return;if(!(yield(0,i.pathExists)(c)))return void(0,n.logWarn)("[dts]",o," generation ignored, required tsconfig");const h=new s.Dts;h.on("log",(e=>{(0,n.logProgress)(e)})),(0,n.logInfo)("[dts]",o,"generation started"),yield h.generate({name:o,inputDir:a,outputPath:d,main:(0,l.removeExt)(u.replace(/^(\.\/?)+/,""))}),(0,n.logSuccess)("[dts]",o,"declaration at",r)}catch(e){(0,n.logError)(`[dts] ${e.message}`)}})))))}))))}}},5022:e=>{e.exports=require("chalk")},4470:e=>{e.exports=require("fs-extra")},6828:e=>{e.exports=require("minimatch")},4007:e=>{e.exports=require("typescript")},2361:e=>{e.exports=require("events")},1017:e=>{e.exports=require("path")}},t={},r=function r(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,r),s.exports}(8780);module.exports=r})();