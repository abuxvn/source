(()=>{"use strict";var e={273:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.mkdirp=r.createWriteStream=r.writeJSON=r.readFile=r.readJSON=r.pathExists=r.copy=r.stat=void 0;var o=t(470);Object.defineProperty(r,"stat",{enumerable:!0,get:function(){return o.stat}}),Object.defineProperty(r,"copy",{enumerable:!0,get:function(){return o.copy}}),Object.defineProperty(r,"pathExists",{enumerable:!0,get:function(){return o.pathExists}}),Object.defineProperty(r,"readJSON",{enumerable:!0,get:function(){return o.readJSON}}),Object.defineProperty(r,"readFile",{enumerable:!0,get:function(){return o.readFile}}),Object.defineProperty(r,"writeJSON",{enumerable:!0,get:function(){return o.writeJSON}}),Object.defineProperty(r,"createWriteStream",{enumerable:!0,get:function(){return o.createWriteStream}}),Object.defineProperty(r,"mkdirp",{enumerable:!0,get:function(){return o.mkdirp}})},559:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.badge=r.colorIndex=r.color=r.logEntries=r.logSuccess=r.logError=r.logWarn=r.logProgress=r.logInfo=r.log=void 0;const o=t(22);r.log=console.log.bind(console),r.logInfo=(...e)=>{console.info(o.bold.blueBright("ℹ"),...e)},r.logProgress=(...e)=>{console.info((0,o.gray)("➤"),...e)},r.logWarn=(...e)=>{console.info((0,o.red)("△"),...e)},r.logError=(...e)=>{e.forEach((e=>{console.error(o.bold.underline.redBright("✘"),e)}))},r.logSuccess=(...e)=>{console.info(o.bold.greenBright("✔"),...e)},r.logEntries=e=>{(0,r.logInfo)(o.bold.cyanBright("Building entries:")),e.forEach((({name:e,target:t,entry:n})=>{(0,r.log)(`   ${e} (${(0,o.italic)(t)}):`),Object.keys(n).forEach((e=>{(0,r.log)(`     ${e}`)}))}))};const n={green:o.green,yellow:o.yellow,blue:o.blue,magenta:o.magenta,cyan:o.cyan,greenBright:o.greenBright,yellowBright:o.yellowBright,blueBright:o.blueBright,magentaBright:o.magentaBright,cyanBright:o.cyanBright},i=Object.keys(n),l={green:o.bgGreen,yellow:o.bgYellow,blue:o.bgBlue,magenta:o.bgMagenta,cyan:o.bgCyan,greenBright:o.bgGreenBright,yellowBright:o.bgYellowBright,blueBright:o.bgBlueBright,magentaBright:o.bgMagentaBright,cyanBright:o.bgCyanBright,red:o.bgRed,redBright:o.bgRedBright};r.color=(e,r="blue")=>r?n[r](e):e,r.colorIndex=(e,t=0)=>{const o=i[t%i.length];return(0,r.color)(e,o)},r.badge=(e,r="blueBright")=>r?l[r](` ${(0,o.bold)(e)} `):e},584:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.removeExt=r.merge=r.resolve=r.resolver=r.getName=r.getDir=r.normalize=r.PathResolver=void 0;const o=t(17);class n{constructor(e){this.rootPath=(0,r.normalize)((0,o.resolve)(e))}relative(e){return(0,r.normalize)((0,o.relative)(this.rootPath,(0,r.normalize)(e)))}relativeList(e){return e.map((e=>this.relative(e)))}includes(e){return 0===(0,r.normalize)(e).indexOf(this.rootPath)}resolve(...e){return(0,r.normalize)((0,o.resolve)(this.rootPath,...e.filter(Boolean).map((e=>e.replace(/^\/+/,"")))))}resolveList(e){return e.map((e=>this.resolve(e)))}dir(){return(0,r.resolver)((0,r.getDir)(this.rootPath))}res(...e){return(0,r.resolver)(this.resolve(...e))}}r.PathResolver=n,r.normalize=e=>(null==e?void 0:e.replace(/\\/g,"/"))||"",r.getDir=e=>(0,r.normalize)(e).replace(/\/[^/]+\/?$/,""),r.getName=e=>(0,o.basename)((0,r.normalize)(e)),r.resolver=e=>new n(e),r.resolve=e=>(0,r.normalize)((0,o.resolve)(e)),r.merge=(...e)=>(0,r.normalize)((0,o.join)(...e)),r.removeExt=e=>null==e?void 0:e.replace(/\.([^/]+)$/,"")},163:function(e,r,t){var o=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))((function(n,i){function l(e){try{s(o.next(e))}catch(e){i(e)}}function a(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(l,a)}s((o=o.apply(e,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.DtsPlugin=void 0;const n=t(273),i=t(903),l=t(559),a=t(584),s=/([^/]+\/[^/]+)/;let c=0;r.DtsPlugin=class{constructor(e){this.path=(0,a.resolver)(e)}apply(e){let r=[];e.hooks.beforeCompile.tapPromise("[dts] start collecting built modules",(()=>o(this,void 0,void 0,(function*(){r=[]})))),e.hooks.compilation.tap("[dts] setup compilation",(e=>{e.hooks.succeedModule.tap("[dts] collect built module",(e=>{if("NormalModule"!==e.constructor.name)return;const t=this.path.relative(e.context||""),o=!t.includes("node_modules")&&!t.includes(".yarn")&&t.match(s);o&&!r.includes(o[0])&&r.push(o[0])}))})),e.hooks.afterCompile.tap("[dts] generate definitions",(()=>{Promise.all(r.map((e=>o(this,void 0,void 0,(function*(){const r=c+=1;try{const t=yield(0,n.readJSON)(this.path.resolve(e,"package.json")),o=t.types,s=t.name,c=this.path.resolve(e),g=this.path.resolve(e,o),u=t.main||"index",d=t.files||"";if(!o)return;let h=this.path.resolve(e,"tsconfig.json");if((yield(0,n.pathExists)(h))||(h=this.path.resolve("tsconfig.json")),!(yield(0,n.pathExists)(h)))return void(0,l.logWarn)(this.log(r,s,"generation ignored, required tsconfig"));const p=new i.Dts,m=d.map((r=>(0,a.resolver)(c).relative(this.path.resolve(e,r))));p.on("log",(e=>{(0,l.logProgress)(this.log(r,e))})),(0,l.logInfo)(this.log(r,s,"generation started")),yield p.generate({projectPath:h,name:s,inputDir:c,outputPath:g,main:(0,a.removeExt)(u.replace(/^(\.\/?)+/,"")),filePatterns:m}),(0,l.logSuccess)(this.log(r,s,"declaration at",o))}catch(e){(0,l.logError)(this.log(r,e.message))}})))))}))}log(e,...r){let t=r.join(" ");return 0!==t.indexOf("[dts")&&(t=`[dts] ${t}`),t.replace(/^\[(dtsw?)\]/,((r,t)=>(0,l.colorIndex)(`[${t} ${e}]`,e)))}}},22:e=>{e.exports=require("chalk")},470:e=>{e.exports=require("fs-extra")},903:e=>{e.exports=require("@abux/builder/src/lib/dts/index.js")},17:e=>{e.exports=require("path")}},r={},t=function t(o){var n=r[o];if(void 0!==n)return n.exports;var i=r[o]={exports:{}};return e[o].call(i.exports,i,i.exports,t),i.exports}(163);module.exports=t})();