(()=>{"use strict";var e={559:(e,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.badge=r.colorIndex=r.color=r.logEntries=r.logSuccess=r.logError=r.logWarn=r.logProgress=r.logInfo=r.log=void 0;const t=o(22);r.log=console.log.bind(console),r.logInfo=(...e)=>{console.info(t.bold.blueBright("ℹ"),...e)},r.logProgress=(...e)=>{console.info((0,t.gray)("➤"),...e)},r.logWarn=(...e)=>{console.info((0,t.red)("△"),...e)},r.logError=(...e)=>{e.forEach((e=>{console.error(t.bold.underline.redBright("✘"),e)}))},r.logSuccess=(...e)=>{console.info(t.bold.greenBright("✔"),...e)},r.logEntries=e=>{(0,r.logInfo)(t.bold.cyanBright("Building entries:")),e.forEach((({name:e,target:o,entry:l})=>{(0,r.log)(`   ${e} (${(0,t.italic)(o)}):`),Object.keys(l).forEach((e=>{(0,r.log)(`     ${e}`)}))}))};const l={green:t.green,yellow:t.yellow,blue:t.blue,magenta:t.magenta,cyan:t.cyan,greenBright:t.greenBright,yellowBright:t.yellowBright,blueBright:t.blueBright,magentaBright:t.magentaBright,cyanBright:t.cyanBright},n=Object.keys(l),i={green:t.bgGreen,yellow:t.bgYellow,blue:t.bgBlue,magenta:t.bgMagenta,cyan:t.bgCyan,greenBright:t.bgGreenBright,yellowBright:t.bgYellowBright,blueBright:t.bgBlueBright,magentaBright:t.bgMagentaBright,cyanBright:t.bgCyanBright,red:t.bgRed,redBright:t.bgRedBright};r.color=(e,r="blue")=>r?l[r](e):e,r.colorIndex=(e,o=0)=>{const t=n[o%n.length];return(0,r.color)(e,t)},r.badge=(e,r="blueBright")=>r?i[r](` ${(0,t.bold)(e)} `):e},584:(e,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.removeExt=r.merge=r.resolve=r.resolver=r.getName=r.getDir=r.normalize=r.PathResolver=void 0;const t=o(17);class l{constructor(e){this.rootPath=(0,r.normalize)((0,t.resolve)(e))}relative(e){return(0,r.normalize)((0,t.relative)(this.rootPath,(0,r.normalize)(e)))}relativeList(e){return e.map((e=>this.relative(e)))}includes(e){return 0===(0,r.normalize)(e).indexOf(this.rootPath)}resolve(...e){return(0,r.normalize)((0,t.resolve)(this.rootPath,...e.filter(Boolean).map((e=>e.replace(/^\/+/,"")))))}resolveList(e){return e.map((e=>this.resolve(e)))}dir(){return(0,r.resolver)((0,r.getDir)(this.rootPath))}res(...e){return(0,r.resolver)(this.resolve(...e))}}r.PathResolver=l,r.normalize=e=>(null==e?void 0:e.replace(/\\/g,"/"))||"",r.getDir=e=>(0,r.normalize)(e).replace(/\/[^/]+\/?$/,""),r.getName=e=>(0,t.basename)((0,r.normalize)(e)),r.resolver=e=>new l(e),r.resolve=e=>(0,r.normalize)((0,t.resolve)(e)),r.merge=(...e)=>(0,r.normalize)((0,t.join)(...e)),r.removeExt=e=>null==e?void 0:e.replace(/\.([^/]+)$/,"")},163:function(e,r,o){var t=this&&this.__awaiter||function(e,r,o,t){return new(o||(o=Promise))((function(l,n){function i(e){try{a(t.next(e))}catch(e){n(e)}}function s(e){try{a(t.throw(e))}catch(e){n(e)}}function a(e){var r;e.done?l(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(i,s)}a((t=t.apply(e,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.DtsPlugin=void 0;const l=o(470),n=o(903),i=o(559),s=o(584),a=/([^/]+\/[^/]+)/;let g=0;r.DtsPlugin=class{constructor(e){this.path=(0,s.resolver)(e)}apply(e){let r=[];e.hooks.beforeCompile.tapPromise("[dts] start collecting built modules",(()=>t(this,void 0,void 0,(function*(){r=[]})))),e.hooks.compilation.tap("[dts] setup compilation",(e=>{e.hooks.succeedModule.tap("[dts] collect built module",(e=>{if("NormalModule"!==e.constructor.name)return;const o=this.path.relative(e.context||""),t=!o.includes("node_modules")&&!o.includes(".yarn")&&o.match(a);t&&!r.includes(t[0])&&r.push(t[0])}))})),e.hooks.afterCompile.tap("[dts] generate definitions",(()=>{Promise.all(r.map((e=>t(this,void 0,void 0,(function*(){const r=g+=1;try{const o=yield(0,l.readJSON)(this.path.resolve(e,"package.json")),t=o.types,a=o.name,g=this.path.resolve(e),c=this.path.resolve(e,t),h=o.main||"index",u=o.files||"";if(!t)return;let d=this.path.resolve(e,"tsconfig.json");if((yield(0,l.pathExists)(d))||(d=this.path.resolve("tsconfig.json")),!(yield(0,l.pathExists)(d)))return void(0,i.logWarn)(this.log(r,a,"generation ignored, required tsconfig"));const p=new n.Dts,v=u.map((r=>(0,s.resolver)(g).relative(this.path.resolve(e,r))));p.on("log",(e=>{(0,i.logProgress)(this.log(r,e))})),(0,i.logInfo)(this.log(r,a,"generation started")),yield p.generate({projectPath:d,name:a,inputDir:g,outputPath:c,main:(0,s.removeExt)(h.replace(/^(\.\/?)+/,"")),filePatterns:v}),(0,i.logSuccess)(this.log(r,a,"declaration at",t))}catch(e){(0,i.logError)(this.log(r,e.message))}})))))}))}log(e,...r){let o=r.join(" ");return 0!==o.indexOf("[dts")&&(o=`[dts] ${o}`),o.replace(/^\[(dtsw?)\]/,((r,o)=>(0,i.colorIndex)(`[${o} ${e}]`,e)))}}},22:e=>{e.exports=require("chalk")},470:e=>{e.exports=require("fs-extra")},903:e=>{e.exports=require("@abux/builder/src/lib/dts/index.js")},17:e=>{e.exports=require("path")}},r={},o=function o(t){var l=r[t];if(void 0!==l)return l.exports;var n=r[t]={exports:{}};return e[t].call(n.exports,n,n.exports,o),n.exports}(163);module.exports=o})();